<% if current_user && current_user.admin? %>
  <%= link_to 'Edit this Product', edit_product_path(@product), class: 'btn btn-warning mb-3' %>
<% end %>
<div class="container mt-5">
  <div class="row">
    <!-- Product Images Carousel -->
    <div class="col-md-4">
      <div id="productCarousel" class="carousel slide" data-ride="carousel">
        <ol class="carousel-indicators">
          <% @product.images.each_with_index do |image, index| %>
            <li data-target="#productCarousel" data-slide-to="<%= index %>" class="<%= 'active' if index == 0 %>"></li>
          <% end %>
        </ol>
        <div class="carousel-inner">
          <% @product.images.each_with_index do |image, index| %>
            <div class="carousel-item <%= 'active' if index == 0 %>">
              <%= image_tag url_for(image), class: 'd-block w-100', alt: "Product Image" %>
            </div>
          <% end %>
        </div>
        <a class="carousel-control-prev" href="#productCarousel" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#productCarousel" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
      <!-- Thumbnail Images -->
      <div class="mt-3">
        <div class="d-flex flex-wrap">
          <% @product.images.each do |image| %>
            <%= image_tag url_for(image), class: 'img-thumbnail mr-2 mb-2', style: 'width: 80px; height: 80px;' %>
          <% end %>
        </div>
      </div>
    </div>
    <!-- Product Details -->
    <div class="col-md-8">
      <h1 class="mb-4"><%= @product.name %></h1>
      <div class="card mb-4">
        <div class="card-body">
          <table class="table table-bordered table-striped">
            <tbody>
              <tr>
                <th>Description</th>
                <td><%= @product.description %></td>
              </tr>
              <tr>
                <th>Price</th>
                <td class="text-success"><%= number_to_currency(@product.price) %></td>
              </tr>
              <tr>
                <th>Stock Quantity</th>
                <td><%= @product.stock_quantity %></td>
              </tr>
              <tr>
                <th>SKU</th>
                <td class="text-muted"><%= @product.SKU %></td>
              </tr>
            </tbody>
          </table>
          <% unless current_user && current_user.admin? %>
            <div class="mt-4">
              <!-- Add to Cart Form -->
              <%= form_with(model: CartItem.new, url: cart_items_path, method: :post, local: true) do |form| %>
                <%= form.hidden_field :product_id, value: @product.id %>
                <div class="form-group">
                  <%= form.label :quantity, "Quantity" %>
                  <%= form.number_field :quantity, value: 1, min: 1, class: 'form-control' %>
                </div>
                <div>
                  <%= form.submit "Add to Cart", class: 'btn btn-primary' %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <!-- Add Bootstrap JavaScript dependencies -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</div>
